@page
@model IndexModel
@{
    ViewData["Title"] = "Topographic Map";
}

<h1>Topographic Map</h1>

<form method="get" class="mb-3">
    <div class="row g-2">
        <div class="col-auto">
            <label class="form-label">Latitude</label>
            <input asp-for="Lat" class="form-control" />
        </div>
        <div class="col-auto">
            <label class="form-label">Longitude</label>
            <input asp-for="Lon" class="form-control" />
        </div>
        <div class="col-auto align-self-end">
            <button type="submit" class="btn btn-primary">Update</button>
        </div>
    </div>
</form>

<div class="mb-3">
    <button id="drawBtn" type="button" class="btn btn-secondary">Draw Mode</button>
    <button id="moveBtn" type="button" class="btn btn-secondary">Move Mode</button>
</div>

<div id="map" style="height:600px;"></div>

@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([@Model.Lat, @Model.Lon], 13);
        L.tileLayer('https://tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 17
        }).addTo(map);

        var drawMode = false;
        var currentLine = null;
        var latlngs = [];

        document.getElementById('drawBtn').onclick = function () {
            drawMode = true;
            map.dragging.disable();
        };
        document.getElementById('moveBtn').onclick = function () {
            drawMode = false;
            map.dragging.enable();
            latlngs = [];
            currentLine = null;
        };

        map.on('click', function (e) {
            if (!drawMode) return;
            latlngs.push(e.latlng);
            if (currentLine) {
                currentLine.setLatLngs(latlngs);
            } else {
                currentLine = L.polyline(latlngs, { color: 'red' }).addTo(map);
            }
        });
    </script>
}
